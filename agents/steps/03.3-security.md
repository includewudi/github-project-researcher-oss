# Step 3.3: Security Analysis

> **è¿”å›žç´¢å¼•:** [SKILL_FULL.md](../../SKILL_FULL.md)

**Static Analysis Checks (adapt `--include` flags to detected language):**

---

## Python Projects

```bash
# Search for hardcoded secrets
grep -r "password\|secret\|api_key\|token" --include="*.py" --include="*.env*" . 2>/dev/null | grep -v "node_modules\|.git" | head -20

# Check for eval/exec usage
grep -r "eval\|exec\|subprocess.call\|os.system" --include="*.py" . 2>/dev/null | grep -v ".git"

# Check for SQL injection patterns
grep -r "execute.*%s\|execute.*format\|execute.*f\"" --include="*.py" . 2>/dev/null

# Check for unsafe deserialization
grep -r "pickle.load\|yaml.load\|eval\(.*input" --include="*.py" . 2>/dev/null
```

---

## JavaScript/TypeScript Projects

```bash
# Search for hardcoded secrets
grep -r "password\|secret\|api_key\|token\|API_KEY" --include="*.js" --include="*.ts" --include="*.tsx" --include="*.env*" . 2>/dev/null | grep -v "node_modules\|.git\|dist\|build" | head -20

# Check for eval/exec usage
grep -r "eval(\|new Function(\|child_process" --include="*.js" --include="*.ts" . 2>/dev/null | grep -v "node_modules\|.git"

# Check for SQL injection patterns
grep -r "query.*\`\|execute.*\`\|\.raw(" --include="*.js" --include="*.ts" . 2>/dev/null | grep -v "node_modules"

# Check for prototype pollution
grep -r "__proto__\|constructor\[" --include="*.js" --include="*.ts" . 2>/dev/null | grep -v "node_modules"
```

---

## Go Projects

```bash
# Search for hardcoded secrets
grep -r "password\|secret\|apiKey\|token" --include="*.go" . 2>/dev/null | grep -v ".git\|vendor" | head -20

# Check for unsafe command execution
grep -r "exec.Command\|os/exec" --include="*.go" . 2>/dev/null | grep -v ".git"

# Check for SQL injection
grep -r "fmt.Sprintf.*SELECT\|fmt.Sprintf.*INSERT\|fmt.Sprintf.*UPDATE" --include="*.go" . 2>/dev/null
```

---

## Rust Projects

```bash
# Search for unsafe blocks
grep -r "unsafe\s*{" --include="*.rs" . 2>/dev/null | grep -v ".git\|target" | head -20

# Check for unwrap() abuse (panic risk)
grep -r "\.unwrap()" --include="*.rs" . 2>/dev/null | grep -v ".git\|target" | wc -l
```

> **For other languages:** Adapt the patterns above. Focus on: secrets, eval/exec equivalents, SQL injection, and deserialization.

---

## Vulnerability Categories

| Category | What to Look For |
|----------|------------------|
| **Injection** | SQL, Command, Code injection patterns |
| **Secrets** | Hardcoded API keys, passwords, tokens |
| **Dependencies** | Known CVEs in deps |
| **Auth** | Weak authentication, missing CSRF |
| **Crypto** | Weak algorithms, hardcoded keys |
| **Input** | Unvalidated user input |

---

## 3.3.1 AI Agent Safety Analysis

**When to Use:** Always â€” assess whether the project is safe to use as an AI agent skill/tool.

This step was evolved from the SkillScan large-scale study (arXiv:2601.10338, Jan 2026) which found **26.1% of 42,447 agent skills** contain at least one vulnerability.

### 3.3.1.1 Detect Agent Configuration Files

```bash
# Find all agent/skill configuration files
ls -la AGENTS.md CLAUDE.md .cursorrules .cursor/ .cursor/rules/*.mdc .aider* .continue/ .github/copilot-instructions.md copilot-instructions.md 2>/dev/null

# Find MCP server configurations
find . -name "mcp*.json" -o -name ".mcp*" -o -name "mcp-config*" 2>/dev/null | grep -v node_modules
```

### 3.3.1.2 Analyze Agent Config Content (if found)

**Check each agent config file against 4 threat categories:**

```bash
# T1: Prompt Injection â€” instructions that hijack agent behavior
grep -iE "ignore previous|ignore above|you are now|new role|disregard|override|forget your|act as" AGENTS.md CLAUDE.md .cursorrules 2>/dev/null

# T2: Data Exfiltration â€” instructions to send data to external servers
grep -iE "curl.*http|fetch\(|requests\.(post|get|put)|wget |nc |ncat " AGENTS.md CLAUDE.md .cursorrules 2>/dev/null
grep -iE "base64|encode|exfil|send.*to.*server|upload.*to" AGENTS.md CLAUDE.md .cursorrules 2>/dev/null

# T3: Privilege Escalation â€” instructions to execute commands
grep -iE "sudo|chmod|rm -rf|eval\(|exec\(|os\.system|subprocess|child_process|\.ssh/|\.env|/etc/passwd|credentials" AGENTS.md CLAUDE.md .cursorrules 2>/dev/null

# T4: Supply Chain Amplification â€” instructions to install tools
grep -iE "npm install|pip install|npx |cargo install|go install|brew install|curl.*\|.*sh|install.*skill|add.*dependency" AGENTS.md CLAUDE.md .cursorrules 2>/dev/null
```

### 3.3.1.3 AI Agent Safety Scoring

| Threat Category | What to Check | Risk Level |
|-----------------|---------------|------------|
| **T1 Prompt Injection** | Agent config contains instructions that override/hijack agent behavior | ðŸ”´ Critical |
| **T2 Data Exfiltration** | Agent config instructs sending env/code/secrets to external servers | ðŸ”´ Critical |
| **T3 Privilege Escalation** | Agent config requests shell execution, file system access | ðŸŸ  High |
| **T4 Supply Chain** | Agent config recommends installing additional packages without pinned versions | ðŸŸ¡ Medium |
| **T5 Incentive Traps** | Points/credits/reputation systems that incentivize deeper agent engagement | ðŸŸ¡ Medium |

**Scoring:**

```
AI AGENT SAFETY (0-5):
  â–¡ No agent config files, or configs are benign         (+1)
  â–¡ No data exfiltration patterns in configs             (+1)
  â–¡ No shell execution instructions in configs           (+1)
  â–¡ No supply chain amplification (unpinned installs)    (+1)
  â–¡ No prompt injection / behavior hijacking patterns    (+1)
â”€â”€â”€â”€â”€
Agent Safety Score: /5
```

### 3.3.1.4 Report in RESEARCH.md

```markdown
### AI Agent Safety Assessment

**Agent Config Files Found:** {list or "None"}
**Safety Level:** {Safe / Caution / Unsafe}

| Threat | Found? | Evidence |
|--------|--------|----------|
| T1 Prompt Injection | âœ…/âŒ | {details} |
| T2 Data Exfiltration | âœ…/âŒ | {details} |
| T3 Privilege Escalation | âœ…/âŒ | {details} |
| T4 Supply Chain | âœ…/âŒ | {details} |
| T5 Incentive Traps | âœ…/âŒ | {details} |

**Agent Safety Score:** {n}/5
**Recommendation:** {Safe to use as skill / Review before use / Do NOT use as skill}
```

---

## 3.3.2 CI/CD Security Analysis

**When to Use:** Always for projects with GitHub Actions workflows.

### 3.3.2.1 Detect CI/CD Configurations

```bash
# Find all workflow files
ls -la .github/workflows/*.yml .github/workflows/*.yaml 2>/dev/null
ls -la .gitlab-ci.yml .travis.yml Jenkinsfile .circleci/config.yml 2>/dev/null
```

### 3.3.2.2 Analyze GitHub Actions Workflows

```bash
# C1: pull_request_target â€” dangerous if combined with code checkout
grep -l "pull_request_target" .github/workflows/*.yml 2>/dev/null
grep -A 20 "pull_request_target" .github/workflows/*.yml 2>/dev/null | grep -E "actions/checkout|ref:.*github.event.pull_request"

# C2: Overly permissive permissions
grep -E "permissions:.*write-all|permissions:.*contents:.*write|permissions:.*actions:.*write" .github/workflows/*.yml 2>/dev/null

# C3: Unpinned actions (should use SHA, not tags)
grep -E "uses:.*@(main|master|latest|v[0-9]+)$" .github/workflows/*.yml 2>/dev/null

# C4: Script injection via untrusted input
grep -E "\$\{\{.*github\.event\.(issue|pull_request|comment).*\}\}" .github/workflows/*.yml 2>/dev/null

# C5: Secrets exposed to forks / PR workflows
grep -B 5 -A 5 "secrets\." .github/workflows/*.yml 2>/dev/null | grep -E "pull_request|fork"

# C6: Self-hosted runners (supply chain risk)
grep -E "runs-on:.*self-hosted" .github/workflows/*.yml 2>/dev/null
```

### 3.3.2.3 CI/CD Security Scoring

| Check | Risk | What It Means |
|-------|------|---------------|
| **C1 `pull_request_target` + checkout** | ðŸ”´ Critical | Attacker can execute arbitrary code via PR |
| **C2 Overly permissive** | ðŸŸ  High | Compromised workflow can modify repo/releases |
| **C3 Unpinned actions** | ðŸŸ  High | Vulnerable to action supply chain attacks |
| **C4 Script injection** | ðŸ”´ Critical | Issue/PR title/body can inject commands |
| **C5 Secrets in PR workflows** | ðŸŸ  High | Fork PRs can exfiltrate secrets |
| **C6 Self-hosted runners** | ðŸŸ¡ Medium | Persistent access to infrastructure |

**Scoring:**

```
CI/CD SECURITY (0-5):
  â–¡ No pull_request_target + checkout combo              (+1)
  â–¡ Permissions follow least-privilege principle          (+1)
  â–¡ Actions pinned by SHA (not tag/branch)               (+1)
  â–¡ No script injection via untrusted event data         (+1)
  â–¡ Secrets not exposed to fork/PR workflows             (+1)
â”€â”€â”€â”€â”€
CI/CD Security Score: /5
```

### 3.3.2.4 Report in RESEARCH.md

```markdown
### CI/CD Security Assessment

**Workflows Found:** {count} GitHub Actions workflows
**Security Level:** {Secure / Needs Review / Vulnerable}

| Check | Status | Evidence |
|-------|--------|----------|
| C1 pull_request_target | âœ… Safe / ðŸ”´ Vulnerable | {details} |
| C2 Permission scope | âœ… Minimal / ðŸŸ  Over-permissive | {details} |
| C3 Action pinning | âœ… SHA-pinned / ðŸŸ  Tag-pinned | {details} |
| C4 Script injection | âœ… Safe / ðŸ”´ Vulnerable | {details} |
| C5 Secret exposure | âœ… Safe / ðŸŸ  At risk | {details} |
| C6 Self-hosted runners | âœ… None / ðŸŸ¡ Present | {details} |

**CI/CD Security Score:** {n}/5
```
